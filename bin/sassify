#!/usr/bin/env node
const path = require('path');
const promisify = require('util').promisify;
const read = promisify(require('fs').readFile);
const write = promisify(require('fs').writeFile);
const root = path.dirname(__dirname);


const postcss = require('postcss');
// temporarily use this
const variablify = require('custom-properties-sass');
const compiler = postcss().use(variablify());
const compile = function(src) {
  return Promise.resolve(compiler.process(src).css.split(';').join(";\n"));
};
// TODO: Log in the right order
console.log(`Writing CSS custom properties to SASS variables:`);
[
  `${root}/color/base-variables`,
  `${root}/decoration/base-variables`,
  `${root}/typography/base-variables`
].forEach(
  function(src) {
    return read(`${src}.css`).then(
      function(css) {
        return compile(css);
      }
    ).then(
      function(sass) {
        console.log(`- ${src}.css > ${src}.sass`);
        return write(`${src}.sass`, sass);
      }
    );
  }
);
console.log(`Writing CSS @imports to SASS @imports:`);
[
  `${root}/color/index`,
  `${root}/decoration/index`,
  `${root}/typography/index`,
  `${root}/index`
].forEach(
  function(src) {
    return read(`${src}.css`).then(
      function(css) {
        return css.toString().replace('.css', '');
      }
    ).then(
      function(sass) {
        console.log(`- ${src}.css > ${src}.sass`);
        return write(`${src}.sass`, sass);
      }
    );
  }
);
